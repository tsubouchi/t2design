プロダクト名は仮称として 「t2design」 とします。各セクションを大きく分けて記載しています。

1. 概要

本システム 「t2design」 は、ユーザーが自然言語（日本語または英語など）でデザインの要件を伝えると、AI（Claude Sonet 3.7 + fal.aiモデル）を用いて高品質なSVG形式の制作物（バナー、雑誌表紙、ポスター、チラシ、Youtube用テロップなど）を自動生成するWebアプリケーションです。

主な特徴は以下のとおりです。
	1.	豊富な出力物
	•	バナー
	•	雑誌表紙
	•	ポスター
	•	チラシなどの各種広告用POP
	•	Youtube向けテロップ（画像および動画対応想定）
	2.	多様なサイズ選択
	•	1:1
	•	4:3 (横長、標準)
	•	16:9 (一般的動画サイズ)
	•	9:16 (縦長)
	•	カスタム (任意のピクセル指定)
	3.	AI画像生成機能 (fal.ai)
	•	fal.aiの2種類のモデルを利用 (flux-pro/v1.1-ultra および flux/dev)
	•	参照画像アップロード (Drag&Drop)、またはAIによる自動生成選択
	•	再生成 (Regenerate) 機能
	4.	会員プラン・クレジット制
	•	無料プラン (Free): 月5回（合計20枚）まで生成 (20pt付与)
	•	一般プラン (Standard): 月100回（合計400枚） (25ドル/月, 500pt付与)
	•	Proプラン: 月500回（合計2000枚） (75ドル/月, 1500pt付与)
	•	クレジットは毎月リセット、追加購入（デポジット）可能
	•	Stripe決済連携
	5.	Firebase連携
	•	Firebase Authentication (Googleログインのみ)
	•	Firebase Realtime Database or Firestore
	•	Firebase Storage (生成したSVGやログ等の保存)
	•	Firebase Hosting or Cloud Functions for Firebase
	•	Node.jsベースのAPI実装
	6.	拡張性・スケーラビリティ
	•	ユーザー数が1,000人程度になっても耐えられる設計
	•	GCP上でのデプロイ、Firebaseによるホスティング
	•	将来的には海外展開を想定

	2. 機能要件

2.1 ユーザー機能
	1.	ユーザー登録／ログイン
	•	Googleアカウントを使ったOAuthログイン。
	•	新規ユーザーはFirebase Authenticationで登録。
	2.	ダッシュボード（マイページ）
	•	現在のクレジット残量表示
	•	自身の制作履歴（生成したデザイン一覧）
	•	利用プランの確認・変更
	3.	制作画面 (AIとの対話)
	1.	目的（何を作るか）選択
	2.	出力サイズ（比率 or カスタム）選択
	3.	要望（テキスト指示、参照URL、参照画像）を入力またはアップロード
	4.	AIが生成したSVGプレビュー（4枚程度のバリエーション）
	5.	選択してダウンロード（SVG or PNG）
* ダウンロード時にクレジット消費
	4.	再生成機能
	•	気に入らない場合、再度生成のリクエストを可能にする
	•	再生成ごとにクレジットを消費（回数またはクレジット）
	5.	決済（Stripe連携）
	•	プラン購入・アップグレード
	•	クレジット追加デポジット購入（100pt〜3000pt, 1ptあたり0.05ドル）
	6.	プラットフォーム投稿機能
	•	デザインをコミュニティで共有
	•	他のユーザーの作品を閲覧（公開設定をしたユーザーのみ）
	7.	ダークモード／ライトモード切り替え

2.2 管理者機能
	1.	ユーザー管理
	•	プランやクレジット残高の確認・変更
	•	BAN／警告処理
	2.	作品管理
	•	公開されているデザインのモデレーション
	3.	システム設定
	•	Claude Sonet 3.7 / fal.ai APIキー設定・管理
	•	Firebase / GCP設定

⸻

3. 画面遷移図 (例)
flowchart LR
    A[ログイン画面] --> B[マイページ]
    B --> |「新しくデザイン作成」| C[デザイン作成画面]
    B --> D[作成履歴]
    B --> E[クレジット管理/課金画面]
    C --> |「保存」| B
    C --> |「再生成」| C
    C --> |「ダウンロード」| B
    D --> B
    E --> B

4. 画面ワイヤーフレーム (概要)

4.1 ログイン画面
	•	Googleログイン ボタンのみ配置
	•	ログイン後 → マイページへ遷移   
	
┌───────────────────┐
│ t2design            │
├───────────────────┤
│    Googleでログイン    │ ← ボタン
└───────────────────┘	 

4.2 マイページ
	•	ヘッダ部分
	•	左上：ロゴ
	•	右上：ユーザー名、ログアウトボタン
	•	中央メイン
	•	「新しくデザインを作成」ボタン
	•	「作成履歴」ボタン
	•	「クレジット管理・プラン変更」ボタン
	•	現在のクレジット/プラン表示
	•	フッタ
	•	ダークモード切り替え

[header: ロゴ][ユーザー名][ログアウト]
---------------------------------------
[ 新しくデザイン作成 ] [ 作成履歴 ]
[ クレジット管理・プラン変更 ]

[ 現在のプラン: Free / Standard / Pro ]
[ クレジット残: xx/xx pt ]
---------------------------------------
[Footer: ダーク/ライト切り替え]	

4.3 デザイン作成画面
	1.	目的選択
	•	ドロップダウン or アイコンボタン：「バナー」「雑誌表紙」「ポスター」「チラシ」「Youtubeテロップ」など
	2.	サイズ選択
	•	ラジオボタン(1:1, 4:3, 16:9, 9:16, カスタム入力)
	3.	要望テキスト入力
	•	「参照URL」「テキストでの要望」など
	4.	参照画像アップロード (Drag & Drop)
	•	またはスキップしてAIに素材作成させるオプション
	5.	「生成する」ボタン
	•	生成待ち中はプログレスバーを表示
	6.	生成結果プレビュー (4枚表示)
	•	「再生成」ボタン
	•	サムネクリックで拡大表示
	•	「ダウンロード(SVG)」「ダウンロード(PNG)」ボタン

[header: ロゴ][ユーザー名][クレジット残]
-------------------------------------------------
1)目的を選ぶ： (バナー / 雑誌表紙 / ...)
2)サイズ： 1:1 | 4:3 | 16:9 | 9:16 | カスタム(px)

[ 要望テキスト入力欄 ]
[ 参照URL欄 ]
[ 画像アップロードドロップゾーン or 参照画像省略 ]

[ 生成する ] ボタン

--- (生成中プログレスバー) ---
[ 生成結果 1 ][ 生成結果 2 ][生成結果 3][生成結果 4]

[ 再生成 ]　| 選んで [ ダウンロードSVG ] [ ダウンロードPNG ]
-------------------------------------------------	

4.4 作成履歴画面
	•	生成したデザインの縮小サムネイル一覧
	•	絞り込み（バナー／ポスター等）
	•	サムネをクリックで拡大・ダウンロード

4.5 クレジット管理画面
	•	現在のプラン
	•	プラン変更ボタン（Stripeサブスクへ誘導）
	•	クレジット追加購入（100〜3000pt）
	•	購入履歴一覧

⸻

5. アーキテクチャ概要 (スケーラビリティ)

以下の構成を推奨します。ユーザー1,000人程度（さらに拡張も可）を想定。
	1.	フロントエンド:
	•	React (Next.js等) またはVue.js
	•	Firebase Hostingでホスティング
	•	Envファイル(.env.local, .env.development)で環境変数管理（fal.ai APIキー, Claude Sonet APIキー 等）
	2.	バックエンド:
	•	Node.js + Express (Cloud Functions for Firebaseとしてデプロイ可能)
	•	画像生成やSVG生成などのリクエストをまとめて管理
	•	Stripe連携のWebhooksも受ける
	3.	AI連携
	•	Claude Sonet 3.7 (LLM)
	•	システムプロンプトを工夫し、SVGコードを正しく生成させる
	•	fal.ai (flux-pro/v1.1-ultra, flux/dev)
	•	画像生成API呼び出し：フロント or バックエンド
	•	必要に応じて画像生成が完了するまでポーリング or Webhook / SSE で受け取る
	4.	データベース:
	•	Firebase Realtime Database または Cloud Firestore
	•	ユーザー情報、クレジット残高、生成履歴などを格納
	5.	ファイルストレージ:
	•	Firebase StorageでSVGファイル・生成した画像を保存
	6.	認証:
	•	Firebase Authentication (Google OAuthのみ)
	7.	決済:
	•	Stripe（サブスクリプション課金、追加クレジット購入）
	8.	監視 / ロギング:
	•	Firebase Console, GCP Cloud Logging

⸻

6. データモデル (一例)
1.	Usersコレクション (Firestore例)

{
  userId: "xxxx", 
  email: "user@example.com",
  displayName: "Yamada Taro",
  plan: "free" | "standard" | "pro",
  credits: 120, // 残クレジット
  createdAt: <timestamp>,
  resetDate: <timestamp>, // 毎月のリセット日時
  ...
}	

2.	Designsコレクション
{
  designId: "design_1234",
  userId: "xxxx",
  title: "バナー用デザイン",
  type: "banner" | "poster" | "magazineCover" | ...,
  svgUrl: "https://...",
  pngUrl: "https://...",
  createdAt: <timestamp>,
  isPublic: true | false
}

7. 開発計画
	1.	フェーズ0: 設計
	•	要件定義・ワイヤーフレーム・DBスキーマ・API設計
	•	Claude Sonet 3.7, fal.aiのAPI検証
	2.	フェーズ1: 基本フロー実装
	•	ログイン (Firebase Authentication + Google)
	•	デザイン作成画面(静的なモック)
	•	fal.aiの画像生成呼び出し
	•	Claude SonetからのSVG取得フロー
	•	最低限のクレジット管理
	3.	フェーズ2: 課金機能 & スケーラビリティ対策
	•	Stripeサブスクと追加クレジット購入
	•	Webhookでクレジット更新
	•	リアルタイムDB or Firestoreでのロギング
	•	デザイン履歴のプレビュー機能
	4.	フェーズ3: デザイン最適化 & コミュニティ機能
	•	SVGプレビューの最適化
	•	投稿・共有機能
	•	ダークモード対応
	5.	フェーズ4: テスト & チューニング
	•	負荷テスト (1,000ユーザー想定)
	•	E2Eテスト (Cypress / Playwright 等)
	•	GCP + Firebase設定チューニング
	6.	フェーズ5: リリース
	•	Firebase Hosting or GCP Cloud Runで公開
	•	国内向けローンチ
	7.	フェーズ6: 海外展開
	•	多言語対応
	•	CDN最適化、エッジロケーション整備

⸻

8. Claude Sonet 3.7用 システムプロンプト（例）

SVGの品質を高めるためのシステムプロンプトの例です。Claudeの指示を厳格に与え、テキストプロンプトからクリーンなSVGを生成させる意図があります。

あなたはプロのデザイナー兼アートディレクターです。
以下のユーザーからの指示に従い、最適なデザインを提案し、完成したデザインをSVGコードのみで出力してください。

注意点:
1. 出力は <svg> タグを含む正しいXML形式で、ビューアで問題なく表示できる構造にしてください。
2. 余計な文字列は含めず、必要なら<!-- -->でコメントを入れてもかまいません。エラーメッセージや解説文は出力しないでください。
3. アートワークとして見栄えを重視し、適切に<defs>や<g>などを活用してください。
4. テキスト要素のフォントや色、パス描画、グラデーションなどを使い、美しいデザインになるように工夫してください。
5. ユーザーの指示にあったテーマや配置を忠実に再現しつつ、バランスや余白を考慮して完成度の高いSVGに仕上げてください。
6. 可能な限りベクターデータを利用し、画像のエンベッド(Base64)は必要最低限にしてください。
7. サイズはユーザー指定の比率を踏まえて必要に応じて viewBox で調整してください。

以上を踏まえ、ユーザーの要望に沿ったプロ品質のデザインをSVG形式で出力してください。

ポイント解説:
	1.	SVGコードのみ
	•	Claudeが余計なテキストを混ぜないようにするため、冒頭で「出力はSVGのみ」と厳格に指定します。
	2.	レイアウトとアートワークを指示
	•	<svg>タグのviewBox指定や、アスペクト比、テキスト要素やパスを駆使するようにリクエストします。
	3.	ガイドライン
	•	フォント指定や色合い、要素のグルーピングなど、美しいデザインのコツをシステムプロンプトで提示します。

ユーザープロンプト（例）:

「バナー広告を制作。サイズは16:9。背景は明るいパステルカラー、太字のキャッチコピーを中央に配置。チラシのように訴求力を高めてほしい。装飾に星やリボンをあしらう」

これに対して、システムプロンプト + ユーザープロンプトを合わせて投げると、ClaudeはSVGコードを直接返却する想定です。

⸻

9. サンプル fal.ai コード呼び出し例

（提供コードをベースに、Drag&Dropで画像生成する例）

export FAL_KEY="YOUR_API_KEY"  // 環境変数に設定

import { fal } from "@fal-ai/client";

async function generateImage(prompt) {
  const result = await fal.subscribe("fal-ai/flux/dev", {
    input: { prompt },
    logs: true,
    onQueueUpdate: (update) => {
      if (update.status === "IN_PROGRESS") {
        update.logs.map((log) => log.message).forEach(console.log);
      }
    },
  });
  console.log(result.data);
  return result.data; // 生成された画像のURLなど
}

フロントエンド（React/Vueなど）からAPIを叩く設計にして、生成結果を受け取ったらプレビュー表示 → SVG生成ボタンを押すことでClaudeにSVGを生成させるイメージです。

⸻

10. まとめ

本仕様書では以下を網羅しました。
	•	機能要件: ログイン、クレジット/課金、SVG/画像生成、履歴、コミュニティ共有
	•	画面構成とワイヤーフレーム: ユーザーが直感的に操作できるUI設計
	•	アーキテクチャ: Firebase×GCP上で、Node.js・Stripe連携、fal.ai活用
	•	開発計画: フェーズに応じたステップ
	•	システムプロンプト例: Claude Sonet 3.7で高品質SVGを出力するための方針
	•	スケーラビリティ考慮: 1,000ユーザー規模を想定しつつ将来拡張可能

この仕様書をベースとして、商用レベルで運用できるプロ品質のデザイン自動生成Webアプリを構築してください。クレジット管理やStripe連携、firebase + Node.jsのバックエンド構成を適切に実装することで、十分にスケーラブルな環境が整います。

⸻

以上が網羅的な仕様書のドラフトとなります。今後の追加要件やUI調整、AIモデルの最適化は運用フェーズで随時ブラッシュアップしながら進めてください。
ご参考になれば幸いです。

3.	Transactionsコレクション (課金履歴)
{
  transactionId: "tx_1234",
  userId: "xxxx",
  type: "subscription" | "creditPurchase",
  amount: 25.00,
  pointsAdded: 500,
  createdAt: <timestamp>,
  stripeCheckoutId: "checkout_..."
}	